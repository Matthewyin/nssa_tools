<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MLG 无穷关卡系统测试</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/theme.css" />
</head>
<body class="min-h-screen">
  <main class="mx-auto max-w-5xl px-4 py-6" style="color: var(--text-color-primary)">
    <h1 class="text-2xl font-bold mb-4 text-white">MLG 无穷关卡系统测试</h1>
    <p class="mb-4 text-sm text-gray-300">
      测试新的无穷关卡系统：动态层级、符号数量、立方体数量
    </p>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <div class="bg-slate-800 p-4 rounded-lg">
        <h3 class="text-lg font-semibold mb-2 text-white">关卡参数</h3>
        <div class="space-y-2 text-sm text-gray-300">
          <div>
            <label class="block">测试关卡：</label>
            <input type="number" id="level-input" value="1" min="1" max="1000" 
                   class="w-full p-2 bg-slate-700 text-white rounded">
          </div>
          <button id="test-btn" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">
            测试关卡参数
          </button>
        </div>
      </div>
      <div class="bg-slate-800 p-4 rounded-lg">
        <h3 class="text-lg font-semibold mb-2 text-white">难度系统</h3>
        <ul class="text-sm text-gray-300 space-y-1">
          <li>• 1-5关：入门</li>
          <li>• 6-15关：进阶</li>
          <li>• 16-30关：高手</li>
          <li>• 31-50关：大师</li>
          <li>• 51-80关：宗师</li>
          <li>• 81-120关：传说</li>
          <li>• 121-200关：史诗</li>
          <li>• 201-300关：神话</li>
          <li>• 301-500关：至尊</li>
          <li>• 500+关：无限系列</li>
        </ul>
      </div>
    </div>
    
    <div class="bg-slate-800 p-4 rounded-lg mb-6">
      <h3 class="text-lg font-semibold mb-3 text-white">关卡参数详情</h3>
      <div id="level-details" class="text-sm text-gray-300">
        点击"测试关卡参数"查看详情
      </div>
    </div>
    
    <div class="bg-slate-800 p-4 rounded-lg mb-6">
      <h3 class="text-lg font-semibold mb-3 text-white">系统特性</h3>
      <ul class="text-sm text-gray-300 space-y-2">
        <li><strong>无穷关卡</strong>：理论上可以无限进行，没有关卡上限</li>
        <li><strong>动态层级</strong>：8-16层，每5关增加1层</li>
        <li><strong>符号增长</strong>：初始15个符号，每关增加2个</li>
        <li><strong>立方体增长</strong>：初始60个，每关增长10%</li>
        <li><strong>网格自适应</strong>：根据立方体数量自动调整网格大小</li>
        <li><strong>响应式缩放</strong>：立方体大小根据网格和屏幕自动调整</li>
        <li><strong>难度递进</strong>：15个难度等级，超高关卡显示具体等级</li>
      </ul>
    </div>
    
    <div class="bg-slate-800 p-4 rounded-lg">
      <h3 class="text-lg font-semibold mb-3 text-white">关卡对比表</h3>
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-gray-300">
          <thead>
            <tr class="border-b border-gray-600">
              <th class="text-left p-2">关卡</th>
              <th class="text-left p-2">难度</th>
              <th class="text-left p-2">层级</th>
              <th class="text-left p-2">符号数</th>
              <th class="text-left p-2">立方体数</th>
              <th class="text-left p-2">网格大小</th>
            </tr>
          </thead>
          <tbody id="level-table">
            <!-- 动态生成 -->
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <script src="js/game.js"></script>
  <script>
    // 复制游戏中的难度标签函数
    function getDifficultyLabel(level) {
      if (level <= 5) return "入门";
      if (level <= 15) return "进阶";
      if (level <= 30) return "高手";
      if (level <= 50) return "大师";
      if (level <= 80) return "宗师";
      if (level <= 120) return "传说";
      if (level <= 200) return "史诗";
      if (level <= 300) return "神话";
      if (level <= 500) return "至尊";
      
      const superLevel = Math.floor((level - 500) / 100);
      const superLabels = ["无极", "混沌", "太初", "永恒", "无限"];
      if (superLevel < superLabels.length) {
        return superLabels[superLevel];
      }
      
      return `无限+${superLevel - superLabels.length + 1}`;
    }
    
    // 复制游戏中的关卡参数计算函数
    function getLevelParams(level) {
      const baseLayers = 8;
      const maxLayers = 16;
      const layerIncrement = Math.floor((level - 1) / 5);
      const layers = Math.min(baseLayers + layerIncrement, maxLayers);
      
      const baseSymbols = 15;
      const symbolsPerLevel = 2;
      const typeCount = Math.min(baseSymbols + (level - 1) * symbolsPerLevel, 73); // SYMBOLS.length
      
      const baseCubeCount = 60;
      const cubeGrowthRate = 1.1;
      const targetCubeCount = Math.floor(baseCubeCount * Math.pow(cubeGrowthRate, level - 1));
      
      const baseGridSize = 7 * 9;
      const gridGrowthFactor = Math.sqrt(targetCubeCount / baseCubeCount);
      const newGridSize = Math.ceil(baseGridSize * gridGrowthFactor);
      
      const aspectRatio = 1.4;
      const cols = Math.ceil(Math.sqrt(newGridSize * aspectRatio));
      const rows = Math.ceil(newGridSize / cols);
      
      const maxPossibleCubes = cols * rows * layers * 0.6;
      const coverDensity = Math.min(0.8, targetCubeCount / maxPossibleCubes);
      
      return { 
        rows, 
        cols, 
        layers, 
        typeCount, 
        coverDensity,
        targetCubeCount 
      };
    }
    
    function testLevel() {
      const level = parseInt(document.getElementById('level-input').value);
      const params = getLevelParams(level);
      const difficulty = getDifficultyLabel(level);
      
      const details = `
<div class="grid grid-cols-2 gap-4">
  <div>
    <h4 class="font-semibold text-white mb-2">关卡 ${level} - ${difficulty}</h4>
    <ul class="space-y-1">
      <li>层级数量: ${params.layers}</li>
      <li>符号类型: ${params.typeCount}</li>
      <li>目标立方体: ${params.targetCubeCount}</li>
    </ul>
  </div>
  <div>
    <h4 class="font-semibold text-white mb-2">网格配置</h4>
    <ul class="space-y-1">
      <li>网格大小: ${params.cols}×${params.rows}</li>
      <li>总格子数: ${params.cols * params.rows}</li>
      <li>填充密度: ${(params.coverDensity * 100).toFixed(1)}%</li>
    </ul>
  </div>
</div>
      `;
      
      document.getElementById('level-details').innerHTML = details;
    }
    
    function generateLevelTable() {
      const levels = [1, 5, 10, 15, 20, 30, 50, 80, 120, 200, 300, 500, 1000];
      const tbody = document.getElementById('level-table');
      
      levels.forEach(level => {
        const params = getLevelParams(level);
        const difficulty = getDifficultyLabel(level);
        
        const row = document.createElement('tr');
        row.className = 'border-b border-gray-700';
        row.innerHTML = `
          <td class="p-2">${level}</td>
          <td class="p-2">${difficulty}</td>
          <td class="p-2">${params.layers}</td>
          <td class="p-2">${params.typeCount}</td>
          <td class="p-2">${params.targetCubeCount}</td>
          <td class="p-2">${params.cols}×${params.rows}</td>
        `;
        tbody.appendChild(row);
      });
    }
    
    // 事件监听
    document.getElementById('test-btn').addEventListener('click', testLevel);
    document.getElementById('level-input').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') testLevel();
    });
    
    // 初始化
    testLevel();
    generateLevelTable();
  </script>
</body>
</html>
