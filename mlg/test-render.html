<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MLG ç«‹æ–¹ä½“æ¸²æŸ“æµ‹è¯•</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/theme.css" />
</head>
<body class="min-h-screen">
  <main class="mx-auto max-w-5xl px-4 py-6" style="color: var(--text-color-primary)">
    <h1 class="text-2xl font-bold mb-4">MLG ç«‹æ–¹ä½“æ¸²æŸ“æ•ˆæœæµ‹è¯•</h1>
    <p class="mb-4 text-sm text-gray-600">
      æµ‹è¯•ä¿®æ”¹åçš„ç«‹æ–¹ä½“æ¸²æŸ“æ•ˆæœï¼šèƒŒæ™¯è‰²ä¸é¡µé¢ä¸€è‡´ï¼Œæ‰‹æœºç«¯è‡ªåŠ¨ç¼©æ”¾
    </p>
    <p class="mb-4 text-xs text-gray-500">
      å±å¹•å®½åº¦: <span id="screen-width"></span>px | ç¼©æ”¾æ¯”ä¾‹: <span id="scale-info"></span>
    </p>
    
    <div id="game-container" class="game-container mlg-card" style="background: var(--card-bg);">
      <canvas id="test-canvas" class="game-canvas" style="height: 400px;"></canvas>
    </div>
    
    <div class="mt-4 text-sm text-gray-600">
      <p>æ¸²æŸ“ç‰¹ç‚¹ï¼š</p>
      <ul class="list-disc list-inside mt-2">
        <li>èƒŒæ™¯è‰²ä¸é¡µé¢ä¸€è‡´ï¼š#f5f5f7</li>
        <li>å“åº”å¼ç¼©æ”¾ï¼šæ‰‹æœºç«¯è‡ªåŠ¨ç¼©å°ç«‹æ–¹ä½“</li>
        <li>æ–°é¢œè‰²æ–¹æ¡ˆï¼šé¡¶å±‚ #FFFDE7ï¼Œä¸‹å±‚ #B0BEC5ï¼Œæ›´ä¸‹å±‚ #90A4AEï¼Œæœ€ä¸‹å±‚ #546E7A</li>
        <li>ä¸šåŠ¡é€»è¾‘ï¼šæ¯ä¸ªä½ç½®çš„æœ€ä¸Šå±‚ç«‹æ–¹ä½“éƒ½æ˜¾ç¤ºä¸ºé¡¶å±‚äº®è‰²</li>
        <li>ç«‹ä½“è¾¹æ¡†ï¼šä¸»è¾¹æ¡† + é«˜å…‰è¾¹æ¡† + ä¾§é¢é˜´å½±</li>
        <li>ç¬¦å·é€æ˜åº¦ï¼šé¡¶å±‚æœ€æ¸…æ™°ï¼Œä¸‹å±‚é€æ¸é€æ˜</li>
      </ul>
    </div>
  </main>

  <script src="js/game.js"></script>
  <script>
    // ç®€å•çš„æµ‹è¯•æ¸²æŸ“
    const canvas = document.getElementById('test-canvas');
    const ctx = canvas.getContext('2d');
    
    // è®¾ç½®ç”»å¸ƒå°ºå¯¸
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width;
    canvas.height = rect.height;
    
    // æµ‹è¯•ç«‹æ–¹ä½“æ•°æ® - æ¨¡æ‹Ÿä¸åŒä½ç½®çš„é¡¶å±‚æƒ…å†µ
    const testTiles = [
      { layer: 0, type: 0, x: 50, y: 50, col: 0, row: 0 },   // ä½ç½®(0,0)çš„åº•å±‚
      { layer: 2, type: 1, x: 50, y: 50, col: 0, row: 0 },   // ä½ç½®(0,0)çš„é¡¶å±‚
      { layer: 1, type: 2, x: 150, y: 50, col: 1, row: 0 },  // ä½ç½®(1,0)çš„é¡¶å±‚
      { layer: 0, type: 3, x: 250, y: 50, col: 2, row: 0 },  // ä½ç½®(2,0)çš„åº•å±‚
      { layer: 1, type: 4, x: 250, y: 50, col: 2, row: 0 },  // ä½ç½®(2,0)çš„ä¸­å±‚
      { layer: 3, type: 5, x: 250, y: 50, col: 2, row: 0 },  // ä½ç½®(2,0)çš„é¡¶å±‚
    ];
    
    // æ˜¾ç¤ºå±å¹•ä¿¡æ¯
    const screenWidth = window.innerWidth;
    let scale = 1;
    if (screenWidth <= 480) {
      scale = 0.6;
    } else if (screenWidth <= 640) {
      scale = 0.7;
    } else if (screenWidth <= 768) {
      scale = 0.85;
    }

    document.getElementById('screen-width').textContent = screenWidth;
    document.getElementById('scale-info').textContent = scale;

    // æ¸…ç©ºç”»å¸ƒå¹¶è®¾ç½®èƒŒæ™¯
    ctx.fillStyle = '#f5f5f7';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // æµ‹è¯•ç¬¦å·
    const symbols = ['ğŸ±', 'ğŸ¶', 'ğŸ­', 'ğŸ¹'];
    
    // è®¡ç®—æ¯ä¸ªä½ç½®çš„é¡¶å±‚ä¿¡æ¯
    const positionTopLayers = new Map();
    testTiles.forEach(tile => {
      const posKey = `${tile.col},${tile.row}`;
      const currentMax = positionTopLayers.get(posKey) || -1;
      if (tile.layer > currentMax) {
        positionTopLayers.set(posKey, tile.layer);
      }
    });

    // ç»˜åˆ¶æµ‹è¯•ç«‹æ–¹ä½“ - ä½¿ç”¨å“åº”å¼å¤§å°å’Œæ–°é€»è¾‘
    testTiles.forEach((tile, index) => {
      const baseFrontW = 80;
      const frontW = Math.floor(baseFrontW * scale);
      const frontH = Math.floor(frontW * 2.2 / 2);
      const depth = Math.floor(frontW * 0.2);

      // è®¡ç®—ç›¸å¯¹æ·±åº¦
      const posKey = `${tile.col},${tile.row}`;
      const topLayerAtPos = positionTopLayers.get(posKey);
      const isTopAtPosition = tile.layer === topLayerAtPos;
      const relativeDepth = topLayerAtPos - tile.layer;

      // ä½¿ç”¨MLGçš„drawCuboidæ–¹æ³•
      if (window.MLG && window.MLG.drawCuboid) {
        window.MLG.drawCuboid(ctx, tile.x, tile.y, frontW, frontH, depth, {
          actualLayer: tile.layer,
          isTopAtPosition: isTopAtPosition,
          relativeDepth: relativeDepth
        });

        // ç»˜åˆ¶ç¬¦å·
        const fontSize = Math.floor(Math.min(frontW, frontH) * 0.6);
        ctx.font = `${fontSize}px system-ui`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';

        // ä½¿ç”¨æ–°çš„ç¬¦å·é€æ˜åº¦é€»è¾‘
        if (isTopAtPosition) {
          ctx.fillStyle = 'rgba(31, 41, 55, 1)';
        } else {
          const symbolOpacity = Math.max(0.3, 1 - (relativeDepth * 0.25));
          ctx.fillStyle = `rgba(31, 41, 55, ${symbolOpacity})`;
        }
        ctx.fillText(symbols[index], tile.x + frontW / 2, tile.y + frontH / 2);
      }
    });
    
    // æ·»åŠ è¯´æ˜æ–‡å­—
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.font = '14px system-ui';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'top';
    ctx.fillText('å±‚çº§ 0-3 ç«‹æ–¹ä½“æ¸²æŸ“æµ‹è¯•', 10, 10);

    // ç›‘å¬çª—å£å¤§å°å˜åŒ–
    function handleResize() {
      // é‡æ–°æ¸²æŸ“
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = rect.height;

      // æ›´æ–°å±å¹•ä¿¡æ¯å¹¶é‡æ–°ç»˜åˆ¶
      const newScreenWidth = window.innerWidth;
      let newScale = 1;
      if (newScreenWidth <= 480) {
        newScale = 0.6;
      } else if (newScreenWidth <= 640) {
        newScale = 0.7;
      } else if (newScreenWidth <= 768) {
        newScale = 0.85;
      }

      document.getElementById('screen-width').textContent = newScreenWidth;
      document.getElementById('scale-info').textContent = newScale;

      // é‡æ–°ç»˜åˆ¶æ‰€æœ‰å†…å®¹
      ctx.fillStyle = '#f5f5f7';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      testTiles.forEach((tile, index) => {
        const baseFrontW = 80;
        const frontW = Math.floor(baseFrontW * newScale);
        const frontH = Math.floor(frontW * 2.2 / 2);
        const depth = Math.floor(frontW * 0.2);

        // è®¡ç®—ç›¸å¯¹æ·±åº¦
        const posKey = `${tile.col},${tile.row}`;
        const topLayerAtPos = positionTopLayers.get(posKey);
        const isTopAtPosition = tile.layer === topLayerAtPos;
        const relativeDepth = topLayerAtPos - tile.layer;

        if (window.MLG && window.MLG.drawCuboid) {
          window.MLG.drawCuboid(ctx, tile.x, tile.y, frontW, frontH, depth, {
            actualLayer: tile.layer,
            isTopAtPosition: isTopAtPosition,
            relativeDepth: relativeDepth
          });

          const fontSize = Math.floor(Math.min(frontW, frontH) * 0.6);
          ctx.font = `${fontSize}px system-ui`;
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';

          // ä½¿ç”¨æ–°çš„ç¬¦å·é€æ˜åº¦é€»è¾‘
          if (isTopAtPosition) {
            ctx.fillStyle = 'rgba(31, 41, 55, 1)';
          } else {
            const symbolOpacity = Math.max(0.3, 1 - (relativeDepth * 0.25));
            ctx.fillStyle = `rgba(31, 41, 55, ${symbolOpacity})`;
          }
          ctx.fillText(symbols[index], tile.x + frontW / 2, tile.y + frontH / 2);
        }
      });

      ctx.fillStyle = 'rgba(0,0,0,0.7)';
      ctx.font = '14px system-ui';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'top';
      ctx.fillText('å±‚çº§ 0-3 ç«‹æ–¹ä½“æ¸²æŸ“æµ‹è¯•', 10, 10);
    }

    window.addEventListener('resize', handleResize);
  </script>
</body>
</html>
