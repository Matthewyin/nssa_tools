# MLG 无穷关卡系统优化指南

## 🎯 优化目标

实现无穷关卡系统，支持理论上无限多的关卡，每个关卡具有动态的游戏参数。

## 📊 系统规格

### 基础参数
- **初始关卡**: 15个符号，60个立方体
- **层级范围**: 8-16层
- **符号增长**: 每关增加2个符号
- **立方体增长**: 每关增长10%（1.1倍）

### 动态计算公式

#### 1. 层级数量
```javascript
const baseLayers = 8;
const maxLayers = 16;
const layerIncrement = Math.floor((level - 1) / 5); // 每5关增加1层
const layers = Math.min(baseLayers + layerIncrement, maxLayers);
```

#### 2. 符号类型数量
```javascript
const baseSymbols = 15;
const symbolsPerLevel = 2;
const typeCount = Math.min(
  baseSymbols + (level - 1) * symbolsPerLevel,
  SYMBOLS.length // 不超过可用符号总数73个
);
```

#### 3. 立方体数量
```javascript
const baseCubeCount = 60;
const cubeGrowthRate = 1.1; // 每关增长10%
const targetCubeCount = Math.floor(
  baseCubeCount * Math.pow(cubeGrowthRate, level - 1)
);
```

#### 4. 网格大小自适应
```javascript
const baseGridSize = 7 * 9; // 基础63格
const gridGrowthFactor = Math.sqrt(targetCubeCount / baseCubeCount);
const newGridSize = Math.ceil(baseGridSize * gridGrowthFactor);

// 计算最优的行列比例（接近4:3）
const aspectRatio = 1.4;
const cols = Math.ceil(Math.sqrt(newGridSize * aspectRatio));
const rows = Math.ceil(newGridSize / cols);
```

## 🏆 难度系统

### 15个难度等级
| 关卡范围 | 难度标签 | 特点 |
|----------|----------|------|
| 1-5 | 入门 | 基础教学 |
| 6-15 | 进阶 | 逐步提升 |
| 16-30 | 高手 | 中等挑战 |
| 31-50 | 大师 | 高难度 |
| 51-80 | 宗师 | 专家级 |
| 81-120 | 传说 | 传奇难度 |
| 121-200 | 史诗 | 史诗挑战 |
| 201-300 | 神话 | 神话级别 |
| 301-500 | 至尊 | 至尊挑战 |
| 501-600 | 无极 | 超越极限 |
| 601-700 | 混沌 | 混沌状态 |
| 701-800 | 太初 | 太初之力 |
| 801-900 | 永恒 | 永恒挑战 |
| 901-1000 | 无限 | 无限可能 |
| 1000+ | 无限+N | 超越无限 |

## 🔧 技术实现

### 1. 关卡参数生成 (`getLevelParams`)
- 动态计算层级、符号、立方体数量
- 自适应网格大小
- 密度调整确保可玩性

### 2. 关卡生成逻辑 (`generateLevel`)
- 权重随机分布（底层权重高）
- 确保立方体数量为3的倍数
- 按目标数量精确控制

### 3. 响应式渲染 (`computeTileRects`)
- 屏幕大小自适应
- 网格大小自适应
- 立方体大小动态调整

### 4. 难度显示 (`getDifficultyLabel`)
- 15个预设难度等级
- 超高关卡显示具体等级
- 无限扩展支持

## 📈 关卡示例

| 关卡 | 难度 | 层级 | 符号数 | 立方体数 | 网格大小 |
|------|------|------|--------|----------|----------|
| 1 | 入门 | 8 | 15 | 60 | 7×9 |
| 5 | 入门 | 8 | 23 | 88 | 8×10 |
| 10 | 进阶 | 9 | 33 | 143 | 9×11 |
| 20 | 高手 | 11 | 53 | 372 | 12×14 |
| 50 | 大师 | 18 | 113 | 7032 | 21×25 |
| 100 | 传说 | 28 | 213 | 1,252,282 | 89×105 |

## 🎮 游戏体验优化

### 1. 性能优化
- 立方体大小自动缩放
- 网格密度智能调整
- 渲染效率优化

### 2. 可玩性保证
- 确保立方体数量为3的倍数
- 合理的密度分布
- 层级权重平衡

### 3. 视觉体验
- 响应式布局
- 动态难度显示
- 清晰的进度反馈

## 🧪 测试验证

### 测试页面
- `mlg/test-infinite-levels.html`: 无穷关卡系统测试
- 支持任意关卡参数查看
- 关卡对比表
- 实时参数计算

### 验证要点
1. **参数合理性**: 确保各关卡参数在合理范围内
2. **性能表现**: 高关卡下的渲染性能
3. **可玩性**: 游戏难度递进的合理性
4. **响应式**: 不同屏幕尺寸的适配

## 🚀 扩展性

### 未来可扩展功能
1. **特殊关卡**: Boss关、挑战关
2. **关卡主题**: 不同视觉主题
3. **动态事件**: 随机事件系统
4. **成就系统**: 里程碑奖励
5. **排行榜**: 全球关卡排名

### 参数调优
- 可通过修改基础参数调整难度曲线
- 支持A/B测试不同的增长率
- 可根据玩家数据优化参数

## 📋 使用指南

1. **开始游戏**: 从关卡1开始，体验渐进式难度
2. **查看参数**: 使用测试页面了解关卡详情
3. **性能监控**: 注意高关卡的性能表现
4. **反馈收集**: 记录玩家对难度曲线的反馈

这个无穷关卡系统为MLG游戏提供了无限的可玩性和挑战性，同时保持了良好的性能和用户体验。
