<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>居中逻辑验证</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #f5f5f5; }
    .test-case { background: white; margin: 10px 0; padding: 15px; border-radius: 8px; border-left: 4px solid #007acc; }
    .result { margin: 10px 0; padding: 10px; border-radius: 4px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
  </style>
</head>
<body>
  <h1>MLG 居中逻辑验证</h1>
  <div id="results"></div>

  <script>
    // 模拟居中计算函数
    function calculateCenter(canvasWidth, canvasHeight, baseGridWidth, baseGridHeight, maxLayerOffset, screenWidth) {
      const isMobile = screenWidth <= 768;
      const isTablet = screenWidth > 768 && screenWidth <= 1024;
      
      // 计算总尺寸
      const totalWidth = baseGridWidth + maxLayerOffset;
      const totalHeight = baseGridHeight + maxLayerOffset;
      
      // 计算实际内容的视觉中心位置
      const layerOffsetX = maxLayerOffset;
      const layerOffsetY = maxLayerOffset;
      const contentVisualCenterX = (baseGridWidth + layerOffsetX) / 2;
      const contentVisualCenterY = (baseGridHeight + layerOffsetY) / 2;
      
      // 画布中心
      const canvasCenterX = canvasWidth / 2;
      const canvasCenterY = canvasHeight / 2;
      
      // 计算理想起点
      let idealStartX = canvasCenterX - contentVisualCenterX;
      let idealStartY = canvasCenterY - contentVisualCenterY;
      
      // 设备特定调整
      let adjustmentX = 0, adjustmentY = 0;
      if (isMobile) {
        adjustmentX = -layerOffsetX * 0.1;
        adjustmentY = -layerOffsetY * 0.05;
      } else if (isTablet) {
        adjustmentX = -layerOffsetX * 0.05;
        adjustmentY = -layerOffsetY * 0.03;
      }
      
      idealStartX += adjustmentX;
      idealStartY += adjustmentY;
      
      // 边界约束
      const margin = isMobile ? 8 : 16;
      let startX, startY;
      
      if (totalWidth > canvasWidth || totalHeight > canvasHeight) {
        if (totalWidth > canvasWidth) {
          const availableWidth = canvasWidth - margin * 2;
          startX = margin + Math.max(0, (availableWidth - baseGridWidth) / 2);
        } else {
          const minX = margin;
          const maxX = canvasWidth - totalWidth - margin;
          startX = Math.max(minX, Math.min(maxX, idealStartX));
        }
        
        if (totalHeight > canvasHeight) {
          const availableHeight = canvasHeight - margin * 2;
          startY = margin + Math.max(0, (availableHeight - baseGridHeight) / 2);
        } else {
          const minY = margin;
          const maxY = canvasHeight - totalHeight - margin;
          startY = Math.max(minY, Math.min(maxY, idealStartY));
        }
      } else {
        const minX = margin;
        const minY = margin;
        const maxX = canvasWidth - totalWidth - margin;
        const maxY = canvasHeight - totalHeight - margin;
        
        startX = Math.max(minX, Math.min(maxX, idealStartX));
        startY = Math.max(minY, Math.min(maxY, idealStartY));
      }
      
      return {
        startX: Math.round(startX),
        startY: Math.round(startY),
        idealStartX: Math.round(idealStartX),
        idealStartY: Math.round(idealStartY),
        contentVisualCenterX: Math.round(contentVisualCenterX),
        contentVisualCenterY: Math.round(contentVisualCenterY),
        canvasCenterX: Math.round(canvasCenterX),
        canvasCenterY: Math.round(canvasCenterY),
        totalWidth: Math.round(totalWidth),
        totalHeight: Math.round(totalHeight),
        deviceType: isMobile ? 'Mobile' : isTablet ? 'Tablet' : 'Desktop',
        adjustmentX: Math.round(adjustmentX),
        adjustmentY: Math.round(adjustmentY)
      };
    }
    
    // 测试用例
    const testCases = [
      {
        name: "PC端 - 标准情况",
        canvasWidth: 800,
        canvasHeight: 600,
        baseGridWidth: 540,
        baseGridHeight: 385,
        maxLayerOffset: 120,
        screenWidth: 1200
      },
      {
        name: "手机端 - 竖屏",
        canvasWidth: 375,
        canvasHeight: 500,
        baseGridWidth: 315,
        baseGridHeight: 245,
        maxLayerOffset: 60,
        screenWidth: 375
      },
      {
        name: "平板端 - 横屏",
        canvasWidth: 768,
        canvasHeight: 500,
        baseGridWidth: 450,
        baseGridHeight: 315,
        maxLayerOffset: 90,
        screenWidth: 768
      },
      {
        name: "PC端 - 内容超出",
        canvasWidth: 600,
        canvasHeight: 400,
        baseGridWidth: 540,
        baseGridHeight: 385,
        maxLayerOffset: 120,
        screenWidth: 1200
      },
      {
        name: "手机端 - 内容超出",
        canvasWidth: 320,
        canvasHeight: 400,
        baseGridWidth: 315,
        baseGridHeight: 245,
        maxLayerOffset: 60,
        screenWidth: 320
      }
    ];
    
    function runTests() {
      const resultsDiv = document.getElementById('results');
      
      testCases.forEach((testCase, index) => {
        const result = calculateCenter(
          testCase.canvasWidth,
          testCase.canvasHeight,
          testCase.baseGridWidth,
          testCase.baseGridHeight,
          testCase.maxLayerOffset,
          testCase.screenWidth
        );
        
        // 验证居中效果
        const actualContentCenterX = result.startX + result.contentVisualCenterX;
        const actualContentCenterY = result.startY + result.contentVisualCenterY;
        const centerOffsetX = Math.abs(actualContentCenterX - result.canvasCenterX);
        const centerOffsetY = Math.abs(actualContentCenterY - result.canvasCenterY);
        
        // 判断是否居中良好（允许一定误差）
        const isWellCentered = centerOffsetX <= 20 && centerOffsetY <= 20;
        
        const testDiv = document.createElement('div');
        testDiv.className = 'test-case';
        testDiv.innerHTML = `
          <h3>${testCase.name}</h3>
          <div class="result ${isWellCentered ? 'success' : 'error'}">
            <strong>居中效果:</strong> ${isWellCentered ? '✅ 良好' : '❌ 偏移过大'}
          </div>
          <div class="result info">
            <strong>设备类型:</strong> ${result.deviceType}<br>
            <strong>画布尺寸:</strong> ${testCase.canvasWidth} × ${testCase.canvasHeight}<br>
            <strong>画布中心:</strong> (${result.canvasCenterX}, ${result.canvasCenterY})<br>
            <strong>内容视觉中心:</strong> (${result.contentVisualCenterX}, ${result.contentVisualCenterY})<br>
            <strong>实际内容中心:</strong> (${actualContentCenterX}, ${actualContentCenterY})<br>
            <strong>中心偏移:</strong> (${centerOffsetX}, ${centerOffsetY})<br>
            <strong>起点位置:</strong> (${result.startX}, ${result.startY})<br>
            <strong>理想起点:</strong> (${result.idealStartX}, ${result.idealStartY})<br>
            <strong>设备调整:</strong> (${result.adjustmentX}, ${result.adjustmentY})<br>
            <strong>总尺寸:</strong> ${result.totalWidth} × ${result.totalHeight}
          </div>
        `;
        
        resultsDiv.appendChild(testDiv);
      });
    }
    
    // 运行测试
    runTests();
  </script>
</body>
</html>
